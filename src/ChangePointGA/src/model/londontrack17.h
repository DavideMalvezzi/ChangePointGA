//****************************************************//
// London Track 2017 model                            //
//****************************************************//

#ifndef TRACK_H
#define TRACK_H

#include <math.h>

#define RACE_LAPS	10
#define RACE_TIME   2340	// s
#define TRACK_LENGTH 1659	// m

#define TRACK_DATA_STEP	10
#define TRACK_DATA_LENGTH 167

//Pendenze da topografica shell
static float SLOPE_DATA[TRACK_DATA_LENGTH] = { 0.395668119, 0.391295187, 0.382128184, 0.368975273, 0.353530399, 0.337906844, 0.32359517, 0.311354277, 0.301392254, 0.293583255, 0.258000658, 0.174506622, 0.04552475, -0.113414287, -0.283793482, -0.454450876, -0.616616123, -0.763801577, -0.892136493, -1.000213269, -1.093917492, -1.182538869, -1.269574259, -1.350649908, -1.421659964, -1.480673995, -1.520778169, -1.533484921, -1.519140165, -1.482073155, -1.427683282, -1.363171268, -1.2937696, -1.222474313, -1.152583601, -1.087241375, -1.022339773, -0.950129234, -0.869612922, -0.784741686, -0.698329251, -0.611395522, -0.526511508, -0.446905682, -0.375289484, -0.315793493, -0.269915645, -0.236760673, -0.214161812, -0.192734776, -0.167423274, -0.137729529, -0.105553237, -0.073376435, -0.044080398, -0.019319794, 0.000456924, 0.019823019, 0.045423521, 0.078912025, 0.11906053, 0.163594688, 0.20937211, 0.258912851, 0.312205524, 0.347413188, 0.353669498, 0.332260246, 0.290877058, 0.238643941, 0.183253055, 0.130158029, 0.082608135, 0.033928686, -0.027046159, -0.102439847, -0.184945646, -0.265355583, -0.333259965, -0.3779018, -0.397150015, -0.395167541, -0.387563418, -0.384440533, -0.389163045, -0.384464725, -0.361275163, -0.320253416, -0.289022489, -0.28324817, -0.304410876, -0.34600657, -0.394848782, -0.43692196, -0.465594393, -0.480338997, -0.483814853, -0.479628852, -0.471097991, -0.460757924, -0.44792517, -0.432632928, -0.41582207, -0.398759823, -0.382572513, -0.369888326, -0.361847773, -0.358173718, -0.357862317, -0.359747747, -0.362813076, -0.368554382, -0.379631686, -0.396220045, -0.41666833, -0.438740066, -0.460440658, -0.477007201, -0.486313497, -0.488753677, -0.437066586, -0.31363862, -0.080616635, 0.256973101, 0.663771687, 1.096210666, 1.516849657, 1.900035255, 2.236824915, 2.529641923, 2.78149139, 2.994769578, 3.171988001, 3.316280139, 3.42291793, 3.484147213, 3.502457294, 3.487579078, 3.45140269, 3.40460068, 3.322737671, 3.165533081, 2.891117584, 2.497810329, 2.0213807, 1.484507428, 0.894594562, 0.277823781, -0.330300163, -0.897665687, -1.347831345, -1.624873357, -1.728776119, -1.690512136, -1.555266686, -1.36719494, -1.161427517, -0.961927933, -0.773559009, -0.598983558, -0.44178706, -0.314510391, -0.218369128, -0.148819212, -0.03690269, 0.009291688, 0.005575013 };

//Raggi stimati da topografica
static float RADIUS_DATA[TRACK_DATA_LENGTH] = { 0, 0, 0, 0, 0.001113636, 0.003675, 0.007647898, 0.012844125, 0.019034308, 0.024886139, 0.029878167, 0.033895406, 0.037008684, 0.039358661, 0.035530091, 0.029560084, 0.023416646, 0.017952504, 0.013444722, 0.010264418, 0.008405773, 0.007704424, 0.007949161, 0.008934851, 0.010298452, 0.01165468, 0.012841655, 0.013228382, 0.012646298, 0.011142862, 0.009959327, 0.010689265, 0.013771563, 0.018286817, 0.022854377, 0.02688451, 0.029647965, 0.030445877, 0.029223755, 0.026206031, 0.022253413, 0.018389997, 0.015037538, 0.012311635, 0.010184374, 0.008570629, 0.007371528, 0.006494505, 0.005860994, 0.005407973, 0.005086703, 0.004860455, 0.004702067, 0.004485233, 0.004163744, 0.0037309, 0.00319751, 0.002580458, 0.002003647, 0.001514498, 0.001122306, 0.001953382, 0.005468, 0.011954392, 0.020036036, 0.027801671, 0.034482503, 0.039886603, 0.044089282, 0.047269533, 0.049628226, 0.051350872, 0.052593764, 0.053481705, 0.052341462, 0.048714547, 0.042711866, 0.036661932, 0.033544957, 0.034260792, 0.03717184, 0.040653763, 0.043149692, 0.042921652, 0.039569037, 0.03330535, 0.026579037, 0.020481238, 0.015395966, 0.011538969, 0.008850937, 0.007163612, 0.006105783, 0.005443501, 0.005029467, 0.004771036, 0.004597832, 0.004457506, 0.004323913, 0.004185182, 0.004036926, 0.003878461, 0.003710745, 0.003535319, 0.003477091, 0.003574477, 0.003824645, 0.004207685, 0.004698905, 0.005281261, 0.005936386, 0.006647607, 0.007401008, 0.008185541, 0.008992725, 0.009763402, 0.010424246, 0.010957733, 0.011372059, 0.011685284, 0.011917424, 0.012086869, 0.012209068, 0.012296336, 0.012102948, 0.011559463, 0.010907562, 0.010262636, 0.009672581, 0.009150914, 0.008694967, 0.008295562, 0.007905449, 0.00746708, 0.006962051, 0.006390753, 0.005761469, 0.005084803, 0.004421023, 0.003844, 0.003374318, 0.003007524, 0.002729131, 0.002522192, 0.002298733, 0.00195155, 0.0015658, 0.001211011, 0.000912763, 0.001586398, 0.004411051, 0.009621404, 0.017024365, 0.026269756, 0.035707889, 0.044071283, 0.050956085, 0.054929044, 0.055741311, 0.053674933, 0.049201709, 0.042815813, 0.039125404, 0.039747234, 0.035140921, 0, 0 };


static float getTrackSlope(float position) {
	float relativePosition = position - (floor(position / TRACK_LENGTH) * TRACK_LENGTH);

	int i = relativePosition / TRACK_DATA_STEP;

	float coeff = (relativePosition - TRACK_DATA_STEP * i) / TRACK_DATA_STEP;

	float slope = SLOPE_DATA[i+1] * coeff + SLOPE_DATA[i] * (1 - coeff);

	//TODO: i + 1 % TRACK_DATA_LENGTH
	return slope * M_PI / 180.0;
}


static float getTrackRadius(float position) {
	float relativePosition = position - ((int)(position / TRACK_LENGTH) * TRACK_LENGTH);
	
	int i = relativePosition / TRACK_DATA_STEP;

	float coeff = (relativePosition - TRACK_DATA_STEP * i) / TRACK_DATA_STEP;

	float radius = fabs(RADIUS_DATA[i+1]) * coeff + fabs(RADIUS_DATA[i]) * (1 - coeff);

	return radius;
}

#endif
